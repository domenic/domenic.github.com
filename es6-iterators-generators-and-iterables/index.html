<!DOCTYPE html>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>ES6 Iterators, Generators, and Iterables</title>
<meta name="description" content="I wrote up a quick guide to the terminology around ES6&rsquo;s iteration-related concepts, plus some notes and otherresources.">

<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="https://blog.domenic.me/es6-iterators-generators-and-iterables/">
<link rel="alternate" type="application/rss+xml" title="Hidden Variables" href="https://blog.domenic.me/atom.xml">



<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@domenic">
<meta property="og:title" content="ES6 Iterators, Generators, and Iterables">
<meta property="og:description" content="I wrote up a quick guide to the terminology around ES6&rsquo;s iteration-related concepts, plus some notes and other
resources.

Definitions

An iterator is an object with a next method that returns { done, value } tuples.

An iterable is an objec...">


<header class="site-header">
  <div class="wrapper">
    <h1 class="site-title"><a href="/">Hidden Variables</a></h1>
    <p class="tagline">Domenic's blog about coding and stuff</p>

    <nav class="site-nav">
      <a href="/archives">Archives</a>
      <a href="/atom.xml">RSS</a>
    </nav>
  </div>
</header>


<div class="page-content">
  <div class="wrapper">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">ES6 Iterators, Generators, and Iterables</h1>
    <p class="post-meta">
      <time datetime="2013-09-06T00:00:00+00:00" itemprop="datePublished">Sep 6, 2013</time>
      
      
 | <a href="/es6-iterators-generators-and-iterables/#commento" data-page-id="https://blog.domenic.me/es6-iterators-generators-and-iterables/">Comments</a>


      | <a href="https://twitter.com/intent/tweet?text=ES6 Iterators, Generators, and Iterables&amp;url=https://blog.domenic.me/es6-iterators-generators-and-iterables/&amp;via=domenic">Tweet</a>
      | posted in 
  <a class="category-link" href="/categories/javascript">JavaScript</a>


    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>I wrote up a quick guide to the terminology around ES6&rsquo;s iteration-related concepts, plus some notes and other
resources.</p>

<h2 id="definitions">Definitions</h2>

<p>An <strong>iterator</strong> is an object with a <code>next</code> method that returns <code>{ done, value }</code> tuples.</p>

<p>An <strong>iterable</strong> is an object which has an internal method, written in the current ES6 draft specs as
<code>obj[@@iterator]()</code>, that returns an iterator.</p>

<p>A <strong>generator</strong> is a specific type of iterator whose <code>next</code> results are determined by the behavior of its corresponding
generator function. Generators also have a <code>throw</code> method, and their <code>next</code> method takes a parameter.</p>

<p>A <strong>generator function</strong> is a special type of function that acts as a constructor for generators. Generator function
bodies can use the contextual keyword <code>yield</code>, and you can send values or exceptions into the body, at the points where
<code>yield</code> appears, via the constructed generator&rsquo;s <code>next</code> and <code>throw</code> methods. Generator functions are written with
<code>function*</code> syntax.</p>

<p>A <strong>generator comprehension</strong> is a shorthand expression for creating generators, e.g.
<code>(for (x of a) for (y of b) x * y)</code>.</p>

<h2 id="notes">Notes</h2>

<h3 id="for-of"><code>for</code>-<code>of</code></h3>

<p>The new <code>for</code>-<code>of</code> loop works on iterables, i.e. you do <code>for (let x of iterable) { /* ... */ }</code>. So for example, it
works on arrays by looking up their <code>Array.prototype[@@iterator]()</code> internal method, which is specified to return an
iterator that does what you&rsquo;d expect. Similarly <code>Map.prototype</code>, <code>Set.prototype</code>, and others all have <code>@@iterator</code>
methods that help them work with <code>for</code>-<code>of</code> and other constructs in the language that consume iterators.</p>

<p>Note that <code>for</code>-<code>in</code> has nothing to do with iterables, or indeed any of the concepts discussed here. It still works as
it did before, looping through enumerable object properties, and it will be pretty useless when given an iterable of any
sort.</p>

<h3 id="iterable-iterators">Iterable Iterators</h3>

<p>An <em>iterator</em> can also be <em>iterable</em> if it has an <code>@@iterator()</code> internal method. Most iterators in the ES6 draft spec
are also iterable, with the internal method just returning <code>this</code>. In particular, all generators created via generator
functions or generator comprehensions have this behavior. So you can do:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">lazySequence</span> <span class="o">=</span> <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">of</span> <span class="nx">a</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="nx">y</span> <span class="nx">of</span> <span class="nx">b</span><span class="p">)</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">z</span> <span class="nx">of</span> <span class="nx">lazySequence</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="making-iterable-objects">Making Iterable Objects</h3>

<p>To make a custom iterable object, you use the <code>Symbol.iterator</code> symbol, which is the inside-JavaScript way of referring
to the specification&rsquo;s <code>@@iterator</code>. It should return an iterator, thus making your object iterable. The easiest way to
write the iterator-returning method is to use generator syntax. Putting this all together, it looks like</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">iterable</span> <span class="o">=</span> <span class="p">{</span>
  <span class="o">*</span><span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]()</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">yield</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">yield</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">x</span> <span class="nx">of</span> <span class="nx">iterable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="generator-comprehension-desugaring">Generator Comprehension Desugaring</h3>

<p>You can think of generator comprehensions as &ldquo;sugar&rdquo; for writing out and immediately invoking a generator function, with
<code>yield</code>s inserted implicitly at certain points. For example, the comprehension <code>(for (x of a) for (y of b) x * y)</code>
desugars to</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span><span class="o">*</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">of</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">y</span> <span class="nx">of</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">yield</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}())</span>
</code></pre></div>
<h3 id="a-weirdness">A Weirdness</h3>

<p>It&rsquo;s not entirely clear why generator comprehensions create generators instead of simple iterable-iterators. In
particular, as you can see from the above desugaring, calling <code>throw</code> or giving a parameter to <code>next</code> is pretty useless:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">g</span> <span class="o">=</span> <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">of</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">);</span>

<span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>                   <span class="c1">// returns { done: false, value: 1 }</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>                  <span class="c1">// returns { done: false, value: 2 }</span>
<span class="nx">g</span><span class="p">.</span><span class="k">throw</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"boo!"</span><span class="p">));</span> <span class="c1">// immediately throws the error</span>
</code></pre></div>
<p>It seems the arguments in favor of generators instead of iterable-iterators are largely that it makes implementers&rsquo; jobs
easier, at least according to
<a href="http://esdiscuss.org/topic/why-do-generator-expressions-return-generators">this es-discuss thread</a> I started.</p>

<h2 id="implementation-status">Implementation Status</h2>

<p>Due to the tireless work of <a href="http://wingolog.org/">Andy Wingo</a>, V8 (Chrome) has support for generator functions, behind
the <code>--harmony</code> flag (or &ldquo;Experimental JavaScript Features&rdquo; in chrome://flags). It also has some form of <code>for</code>-<code>of</code>,
which only works with generators and with the custom iterables returned by <code>Array.prototype.values</code> and
<code>Array.prototype.keys</code>, but does not work with anything else (e.g. arrays themselves). I assume this is because the
iteration protocol has not been implemented yet. V8 does not have generator comprehensions.</p>

<p>SpiderMonkey (Firefox) has an old version of everything here, with outdated syntax and semantics. Over the last week or
so, Andy has submitted patches to update their generator implementation. He&rsquo;s now working on <code>for</code>-<code>of</code> and the
iteration protocol in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=907077">bug #907077</a>; no word on generator
comprehensions. Note that SpiderMonkey, unlike V8, does not hide these features behind a default-off flag.</p>

<p>Chakra (Internet Explorer) is as always a complete mystery, with no transparency into their development cycle or even
priority list.</p>

<p>And I still haven&rsquo;t forgiven JavaScriptCore (Safari) for its long period of forgetting to implement
<code>Function.prototype.bind</code>, so I haven&rsquo;t even tried looking into their status.</p>

  </div>

</article>


  <section>
    <h1>Comments</h1>
    <div id="commento"></div>
  </section>


<script src="https://platform.twitter.com/widgets.js" async></script>

  </div>
</div>

<footer class="site-footer">
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <p>Hidden Variables</p>
        <p>Source at <a href="https://github.com/domenic/blog.domenic.me/">domenic/blog.domenic.me</a></p>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/domenic"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">domenic</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/domenic"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">domenic</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Copyright Â© 2020 Domenic Denicola</p>
        <p><a href="mailto:d@domenic.me">d@domenic.me</a></p>
      </div>
    </div>

  </div>
</footer>



  
  <script defer src="https://cdn.commento.io/js/commento.js" data-page-id="https://blog.domenic.me/es6-iterators-generators-and-iterables/"></script>

<script src="https://cdn.commento.io/js/count.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37626687-1', 'auto');
  ga('send', 'pageview');
</script>

