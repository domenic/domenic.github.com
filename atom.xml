<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Hidden Variables</title>
    <description>Domenic&#39;s blog about coding and stuff</description>
    <link>https://blog.domenic.me/</link>
    <atom:link href="https://blog.domenic.me/atom.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Sat, 03 Oct 2020 20:20:05 +0000</pubDate>
    <lastBuildDate>Sat, 03 Oct 2020 20:20:05 +0000</lastBuildDate>
    <generator>Jekyll v3.0.1</generator>
    
      <item>
        <title>DigitalOcean&#39;s Hacktoberfest is Hurting Open Source</title>
        <description>&lt;p&gt;For the last couple of years, &lt;a href=&quot;https://www.digitalocean.com/&quot;&gt;DigitalOcean&lt;/a&gt; has run
&lt;a href=&quot;https://hacktoberfest.digitalocean.com/&quot;&gt;Hacktoberfest&lt;/a&gt;, which purports to &amp;ldquo;support open source&amp;rdquo; by giving free
t-shirts to people who send pull requests to open source repositories.&lt;/p&gt;

&lt;p&gt;In reality, &lt;strong&gt;Hacktoberfest is a corporate-sponsored distributed denial of service attack against the open source
maintainer community&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;So far today, on &lt;a href=&quot;https://github.com/whatwg/html/pulls?q=is%3Apr+is%3Aclosed+label%3Aspam&quot;&gt;a single repository&lt;/a&gt;, myself
and fellow maintainers have closed 11 spam pull requests. Each of these generates notifications, often email, to the 485
watchers of the repository. And each of them requires maintainer time to visit the pull request page, evaluate its
spamminess, close it, tag it as spam, lock the thread to prevent further spam comments, and then report the spammer to
GitHub in the hopes of stopping their time-wasting rampage.&lt;/p&gt;

&lt;p&gt;The rate of spam pull requests is, at this time, around four per hour. &lt;em&gt;And it&amp;rsquo;s not even October yet in my timezone.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/hacktoberfest-spam-listing.png&quot; alt=&quot;A screenshot showing a spam query for the whatwg/html repository, which is at this time up to 14 spam PRs&quot;&gt;&lt;/p&gt;

&lt;p&gt;Myself and other maintainers of the whatwg/html repository are not alone in suffering this deluge.
&lt;a href=&quot;https://twitter.com/gravitystorm/status/1311386082982924289&quot;&gt;My tweet&lt;/a&gt; got commiseration from
&lt;a href=&quot;https://mobile.twitter.com/gravitystorm/status/1311386082982924289&quot;&gt;OpenStreetMap, phpMyAdmin&lt;/a&gt;,
&lt;a href=&quot;https://mobile.twitter.com/ulmerleben/status/1311378655231332355&quot;&gt;PubCSS&lt;/a&gt;,
&lt;a href=&quot;https://mobile.twitter.com/JakeDChampion/status/1311389420638138370&quot;&gt;GitHub, the Financial Times&lt;/a&gt;,
&lt;a href=&quot;https://twitter.com/slicknet/status/1311377444188770312&quot;&gt;ESLint&lt;/a&gt;, a
&lt;a href=&quot;https://mobile.twitter.com/zekjur/status/1311411780162326531&quot;&gt;computer club website&lt;/a&gt;, and
&lt;a href=&quot;https://mobile.twitter.com/juliusvolz/status/1311412919196844038&quot;&gt;a conference website&lt;/a&gt;, just within the first couple
of hours. Since then a dedicated account &amp;ldquo;&lt;a href=&quot;https://twitter.com/shitoberfest&quot;&gt;@shitoberfest&lt;/a&gt;&amp;rdquo; has arisen to document the
barrage. Some &lt;a href=&quot;https://github.com/search?q=is%3Apr+%22improve+docs%22+created%3A%3E2020-09-29&amp;amp;type=Issues&quot;&gt;cursory&lt;/a&gt;
&lt;a href=&quot;https://github.com/search?q=is%3Apr+label%3Ainvalid+created%3A%3E2020-09-29&amp;amp;type=Issues&quot;&gt;searches&lt;/a&gt; show thousands of
spam pull requests, and rising.&lt;/p&gt;

&lt;p&gt;DigitalOcean seems to be aware that they have a spam problem. Their solution, per their
&lt;a href=&quot;https://hacktoberfest.digitalocean.com/faq&quot;&gt;FAQ&lt;/a&gt;, is to put the burden solely on the shoulders of maintainers. If we go
out of our way to tag a contribution as spam, then&amp;hellip; we slightly decrease the chance of the spammer getting their free
t-shirt. In reality, the spammer will just keep going, submitting more pull requests to more repositories, until they
finally find a repository where the maintainer doesn&amp;rsquo;t bother to tag the PR as spam, or where the maintainer isn&amp;rsquo;t
available during the seven-day window DigitalOcean uses for spam-tracking.&lt;/p&gt;

&lt;p&gt;To be clear, myself and my fellow maintainers did not ask for this. This is not an opt-in situation. If your open source
project is public on GitHub, DigitalOcean will incentivize people to spam you. There is no consent involved. Either we
contribute to DigitalOcean&amp;rsquo;s marketing project, or,
&lt;a href=&quot;https://twitter.com/SudoFox/status/1311431141702819840&quot;&gt;they suggest, we should quit open source&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Hacktoberfest does not support open source. Instead, it drives open source maintainers even closer to
&lt;a href=&quot;https://www.google.com/search?q=open+source+burnout&quot;&gt;burnout&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/hacktoberfest-spam-pr.png&quot; alt=&quot;A screenshot of a spam PR which adds the heading &amp;quot;Great Work&amp;quot; to the HTML Standard README&quot;&gt;&lt;/p&gt;

&lt;h2 id=&quot;what-can-we-do&quot;&gt;What can we do?&lt;/h2&gt;

&lt;p&gt;My most fervent hope is that DigitalOcean will see the harm they are doing to the open source community, and put an end
to Hacktoberfest. I hope they can do it as soon as possible, before October becomes another lowpoint in the hell-year
that is 2020. In 2021, they could consider relaunching it as an opt-in project, where maintainers consent on a
per-repository basis to deal with such t-shirt–incentivized contributors.&lt;/p&gt;

&lt;p&gt;To protect ourselves, maintainers have a few options. First, you can take the feeble step of ensuring that any spam
against your repositories doesn&amp;rsquo;t contribute to the spammer&amp;rsquo;s &amp;ldquo;t-shirt points&amp;rdquo;, by tagging pull requests with a &amp;ldquo;spam&amp;rdquo;
label, and &lt;a href=&quot;https://twitter.com/MattIPv4/status/1311390498888781824&quot;&gt;emailing hacktoberfest@digitalocean.com&lt;/a&gt;.
DigitalOcean themselves, however, admit that
&lt;a href=&quot;https://twitter.com/MattIPv4/status/1311390054334554113&quot;&gt;this won&amp;rsquo;t stop the problem they&amp;rsquo;ve unleashed on us&lt;/a&gt;. But
maybe it will contribute to the &lt;a href=&quot;https://github.com/MattIPv4/hacktoberfest-data&quot;&gt;metrics&lt;/a&gt; they collect, which last year
showed that &amp;ldquo;only&amp;rdquo; 3,712 pull requests were labeled as spam by project maintainers.&lt;/p&gt;

&lt;p&gt;If you&amp;rsquo;re comfortable cutting off genuine contributions from new users, you can try enabling GitHub&amp;rsquo;s
&lt;a href=&quot;https://docs.github.com/en/free-pro-team@latest/github/building-a-strong-community/limiting-interactions-in-your-repository&quot;&gt;interaction limits&lt;/a&gt;.
However, &lt;del&gt;you have to do this every 24 hours, and&lt;/del&gt; it has the drawback of also disabling issue creation and
comments. &lt;ins&gt;Update: GitHub has made the limit configurable, and has
&lt;a href=&quot;https://twitter.com/github/status/1311772722234560517&quot;&gt;a nice cheeky announcement tweet&lt;/a&gt; zooming in on the &amp;ldquo;1 month&amp;rdquo;
option.&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;Another promising route would be if GitHub would cut off DigitalOcean&amp;rsquo;s API access, as
&lt;a href=&quot;https://twitter.com/__agwa/status/1311399074814472194&quot;&gt;Andrew Ayer has suggested&lt;/a&gt;. It&amp;rsquo;s not clear whether DigitalOcean
is committing a terms of service violation that would support such measures. But they&amp;rsquo;re certainly making GitHub a
less-pleasant place to be, and I hope GitHub can think seriously about how to discourage such corporate-sponsored
attacks on the open source community.&lt;/p&gt;

&lt;p&gt;Finally, and most importantly, we can remember that this is how DigitalOcean treats the open source maintainer
community, and stay away from their products going forward. Although we&amp;rsquo;ve enjoyed using them for hosting the
&lt;a href=&quot;https://whatwg.org/&quot;&gt;WHATWG&lt;/a&gt; standards organization, this kind of behavior is not something we want to support, so
we&amp;rsquo;re starting to investigate alternatives.&lt;/p&gt;
</description>
        <pubDate>Wed, 30 Sep 2020 21:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/hacktoberfest/</link>
        <guid isPermaLink="true">https://blog.domenic.me/hacktoberfest/</guid>
        
        
        <category>Open Source</category>
        
      </item>
    
      <item>
        <title>Mathematical Consciousness</title>
        <description>&lt;p&gt;&lt;em&gt;This post is spurred by reading &lt;a href=&quot;http://www.amazon.com/gp/product/1597805394/ref=as_li_tl?ie=UTF8&amp;amp;camp=1789&amp;amp;creative=9325&amp;amp;creativeASIN=1597805394&amp;amp;linkCode=as2&amp;amp;tag=hiddevaria-20&amp;amp;linkId=2AWNAXTWHGOHWXWS&quot;&gt;&lt;cite&gt;Permutation City&lt;/cite&gt;&lt;/a&gt;, which is excellently thought-provoking. &lt;a href=&quot;http://gregegan.customer.netspace.net.au/&quot;&gt;Greg Egan&lt;/a&gt; is now one of my favorite authors.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;thought-experiments&quot;&gt;Thought Experiments&lt;/h2&gt;

&lt;p&gt;I hold no dualist notions, and do not find philosophical zombies very convincing either. As such, I am fully prepared to believe that if you were to create a sufficiently-detailed simulation of my brain, and run it inside a sufficiently-powerful computer, it would experience consciousness. There are certainly short- and medium-term practical obstacles to this, in terms of our poor understanding of what is necessary for a sufficiently-detailed brain simulation. But I see no reason this wouldn&amp;rsquo;t be possible eventually.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s consider what this simulation really is: a program, which generates a series of (very long) numbers. Each number represents the state of the computer&amp;rsquo;s memory at that point in the simulation. Let&amp;rsquo;s take the sequence of numbers representing ten simulated minutes of brain time. As the machine&amp;rsquo;s memory evolves according to these numbers throughout ten minutes, we have a simulacrum of me experiencing consciousness.&lt;/p&gt;

&lt;p&gt;What would happen if we evolved the computer&amp;rsquo;s memory a bit more slowly? Say, instead of holding these numbers in memory at their original rate, we took twice as long—twenty minutes. What does the simulacrum-me experience? Obviously, it still experiences ten minutes of consciousness; it has no frame of reference that tells it that &amp;ldquo;out there&amp;rdquo; twenty minutes have passed.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s try something else. What if we got rid of the program simulating the brain, and simply replaced it with a dumb program that read the ten-minutes-of-numbers off disk and loaded them into memory, in sequence. This should be functionally identical; it doesn&amp;rsquo;t matter whether the memory was computed ahead of time or in real time. The system will still have a conscious experience. It can&amp;rsquo;t tell whether those numbers came from the CPU or the hard disk.&lt;/p&gt;

&lt;p&gt;What if I, the physical human, wrote down all those numbers on pieces of paper in sequence? Does that written-on paper now experience consciousness? It seems like it should; there&amp;rsquo;s nothing magical about transistors. Remember, no dualism allowed.&lt;/p&gt;

&lt;p&gt;Does it make a difference how good my handwriting is?&lt;/p&gt;

&lt;p&gt;What if I only wrote down the first such number? Assuming a deterministic universe, there is a set of rules that will evolve that single number forward in time, to live a full life (even beyond the ten minutes we originally ran the computer program for). Maybe I&amp;rsquo;d need to write down some encoding of those deterministic rules, too—although I&amp;rsquo;m not sure why. Does that single written-down number experience consciousness?&lt;/p&gt;

&lt;p&gt;What if we never involved computers, computer memory, or paper at all? The number still exists, even without me writing it down, as do the rules for evolving it. (Even without humans around to count, the number five still exists.) Does &amp;hellip; something &amp;hellip; still experience consciousness?&lt;/p&gt;

&lt;h2 id=&quot;thought-conclusions&quot;&gt;Thought Conclusions&lt;/h2&gt;

&lt;p&gt;I imagine there are two reactions to this. Perhaps the more common will be to assume I&amp;rsquo;m performing a &lt;i&gt;reductio ad absurdum&lt;/i&gt; on the idea of simulating conscious experience. I started from that premise, and came to the conclusion that my (simulated?) consciousness exists and experiences things independent of any physical substrate. Seems absurd, so something must have gone wrong, right?&lt;/p&gt;

&lt;p&gt;I don&amp;rsquo;t think so. Not only is the chain of logic inescapable, but this line of thinking also points toward a sublime solution to some of the biggest questions around. Namely, why does anything exist at all? And, why is mathematics so spectacularly effective at describing the physical universe?&lt;/p&gt;

&lt;p&gt;The answer is that the universe itself is simply a timeless mathematical construct. Of what type, we&amp;rsquo;re not exactly sure yet; it&amp;rsquo;s looking like it&amp;rsquo;ll be some kind of mashup of a 3+1-dimensional pseudo-Riemannian manifold with tensor fields obeying certain partial differential equations, plus operator-valued fields on ℝ&lt;sup&gt;4&lt;/sup&gt; with certain commutation relations acting on an abstract Hilbert space. But when we do have our theory of everything, plus the initial conditions of the universe, it&amp;rsquo;s clear to me that within its Platonic mathematical structure lies all of the manifest complexity and consciousness we observe around us.&lt;/p&gt;

&lt;p&gt;There&amp;rsquo;s no need to run a simulation. The mathematical structure exists, independent of human discovery, or of computers to run it. And that&amp;rsquo;s why you and I exist.&lt;/p&gt;

&lt;h2 id=&quot;further-reading&quot;&gt;Further Reading&lt;/h2&gt;

&lt;p&gt;If you find this interesting and potentially compelling, I recommend the following resources:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.amazon.com/gp/product/1597805394/ref=as_li_tl?ie=UTF8&amp;amp;camp=1789&amp;amp;creative=9325&amp;amp;creativeASIN=1597805394&amp;amp;linkCode=as2&amp;amp;tag=hiddevaria-20&amp;amp;linkId=2AWNAXTWHGOHWXWS&quot;&gt;&lt;cite&gt;Permutation City&lt;/cite&gt;&lt;/a&gt; places these ideas in a fictional context, to great effect&lt;/li&gt;
&lt;li&gt;Tegmark&amp;rsquo;s papers: &lt;a href=&quot;http://arxiv.org/abs/gr-qc/9704009&quot;&gt;&lt;cite&gt;Is &amp;ldquo;the theory of everything&amp;rdquo; merely the ultimate ensemble theory?&lt;/cite&gt;&lt;/a&gt; (1997) and &lt;a href=&quot;http://arxiv.org/abs/0704.0646&quot;&gt;&lt;cite&gt;The mathematical universe&lt;/cite&gt;&lt;/a&gt; (2007)&lt;/li&gt;
&lt;li&gt;Peter Woit&amp;rsquo;s &lt;a href=&quot;https://www.math.columbia.edu/%7Ewoit/wordpress/?p=6551&quot;&gt;critique of Tegmark&lt;/a&gt;, pointing out that this does not make any real testable predictions and thus is more philosophy than science (which is fine by me)&lt;/li&gt;
&lt;li&gt;Hans Moravec&amp;rsquo;s &lt;a href=&quot;http://www.frc.ri.cmu.edu/~hpm/project.archive/general.articles/1998/SimConEx.98.html&quot;&gt;&lt;cite&gt;Simulation, Consciousness, Existence&lt;/cite&gt;&lt;/a&gt; which contains a deeper investigation of these issues, including some talk of morality&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Mon, 18 Jan 2016 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/mathematical-consciousness/</link>
        <guid isPermaLink="true">https://blog.domenic.me/mathematical-consciousness/</guid>
        
        
        <category>Not Software</category>
        
      </item>
    
      <item>
        <title>Reading from Sockets</title>
        <description>&lt;p&gt;&lt;em&gt;This post is part of a series on the byte sources underlying the readable streams in the Streams Standard. See &lt;a href=&quot;/byte-sources-introduction/&quot;&gt;the introductory post&lt;/a&gt; for more background and links to the rest of the series.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;At the simplest level, sockets can be treated much the same as files. You can get a file descriptor for the socket, and while there are a number APIs involved in setting it up to actually connect to a remote server, once you&amp;rsquo;ve done that you can read from it using the same read(2) interface as &lt;a href=&quot;/reading-from-files/&quot;&gt;we discussed for files&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But! For sockets, there&amp;rsquo;s an advanced technique available. Instead of using the straightforward-but-blocking read(2) call, we can fine-tune our syscall usage to give us our first taste of &lt;strong&gt;non-blocking I/O&lt;/strong&gt;.  That is, there&amp;rsquo;s a way to arrange it so that—without spinning up any threads—we can continue doing work while the OS gets our data ready for us.&lt;/p&gt;

&lt;h2 id=&quot;non-blocking-socket-i-o&quot;&gt;Non-Blocking Socket I/O&lt;/h2&gt;

&lt;p&gt;A quick aside. In higher-level languages, non-blocking &lt;em&gt;I/O&lt;/em&gt; is often conflated with non-blocking &lt;em&gt;APIs&lt;/em&gt;. These are actually distinct concepts, and for clarity we&amp;rsquo;ll refer to the latter as &amp;ldquo;asynchronous&amp;rdquo; instead. So: I/O can be blocking or non-blocking; APIs can be synchronous or asynchronous. An asynchronous API in a higher-level language might be backed by non-blocking I/O syscalls, or it might be backed by blocking I/O syscalls in a threadpool (as we showed in the file case).&lt;/p&gt;

&lt;p&gt;What&amp;rsquo;s really interesting is what the APIs for non-blocking I/O look like in C. They&amp;rsquo;re nothing like what you might expect from working in a higher-level language, where concepts like &amp;ldquo;events&amp;rdquo; or &amp;ldquo;callbacks&amp;rdquo; are present to do the heavy lifting. Instead, it works something like this:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;When creating the socket, you set it to non-blocking mode.&lt;/li&gt;
&lt;li&gt;You go do some other work, and every once in a while, you come back and try to read some data from the socket.

&lt;ul&gt;
&lt;li&gt;If the OS has data ready for you, you get it instantly!&lt;/li&gt;
&lt;li&gt;Otherwise, if there&amp;rsquo;s no data ready, the OS returns a special error code, saying to try again later.&lt;/li&gt;
&lt;li&gt;(Of course, there&amp;rsquo;s always the possibility that something went wrong, and you&amp;rsquo;ll get a non-special error code.)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The devil is in the details of how you &amp;ldquo;go do some other work&amp;rdquo; and &amp;ldquo;every once in a while&amp;rdquo; come back to check on your socket. Or, more likely, sockets plural: what kind of self-respecting program will only be dealing with a single socket?&lt;/p&gt;

&lt;p&gt;The usual solution consists of two parts. First, redesign your program to be centered around an event loop, which continually cycles through the various things it might have to do—computation, reacting to user input, checking on and trying to read from any non-blocking sockets, processing the resulting data once it gets read, etc. Second, take advantage of some advanced APIs like &lt;a href=&quot;http://linux.die.net/man/2/select&quot;&gt;select(2)&lt;/a&gt; or &lt;a href=&quot;http://linux.die.net/man/4/epoll&quot;&gt;epoll(4)&lt;/a&gt;, to allow you to check on multiple sockets at once without needing to supply a buffer to each of them. In practice, the heavy lifting for both of these is usually provided by a library like &lt;a href=&quot;http://libevent.org/&quot;&gt;libevent&lt;/a&gt; (the original) or &lt;a href=&quot;https://github.com/libuv/libuv&quot;&gt;libuv&lt;/a&gt; (the new hotness).&lt;/p&gt;

&lt;h2 id=&quot;javascript-translation&quot;&gt;JavaScript Translation&lt;/h2&gt;

&lt;p&gt;In the previous episode, we were able to do a fairly direct translation of read(2)-in-a-threadpool into a promise-returning &lt;code&gt;file.readInto&lt;/code&gt; API. For sockets, we&amp;rsquo;re going to need to skip a few more steps: the jump from select(2) to evented programming is just too great to map out directly.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s assume we&amp;rsquo;ve somehow integrated our host program&amp;rsquo;s event loop (e.g., the one provided by libuv) with the JavaScript event loop. We can then have some host environment code that, each time through the loop, uses select(2) or similar to check if the socket has any data available. If it does, it needs to communicate that to JavaScript somehow. An easy way to do this would be with an event:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;readable&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once we know that the socket has some data available, what should the JavaScript API for reading it look like? Its general shape will be pretty similar to our &lt;code&gt;file.readInto&lt;/code&gt; from before. But this time, we know the result is going to be synchronous. That means we don&amp;rsquo;t need to worry about observable data races, and so we can skip all the transfer stuff we had to do last time to avoid them. The end result ends up being:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;readable&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bytesRead&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;readInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// `buffer`&#39;s bytes in the range (offset, offset + bytesRead)&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// have been filled in&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Not too bad!&lt;/p&gt;

&lt;h2 id=&quot;sockets-vs-files&quot;&gt;Sockets vs. Files&lt;/h2&gt;

&lt;p&gt;With this JavaScript translation in hand, we can more easily probe the differences between non-blocking socket I/O, and file I/O. It turns out there are quite a few.&lt;/p&gt;

&lt;p&gt;The first point to note is that we&amp;rsquo;re being proactively told: &lt;em&gt;there is data ready for you&lt;/em&gt;. But where does that data live while it&amp;rsquo;s waiting for you to come pick it up? The answer is that the OS kernel maintains its own buffer of data for that socket, where the data accumulates until you read it. If you decline to read it, then the buffer will just keep filling up, until eventually it reaches a built-in limit. Once that happens, you&amp;rsquo;ll start losing data!&lt;/p&gt;

&lt;p&gt;This is a big difference between sockets and the higher-level stream APIs you might be used to. Streams generally go to great pains to ensure you never lose any data. But this means that any streams wrapping a socket must be careful to always pull data out of the kernel buffer before it gets too full, and then keep it around in their own user-space buffer until it&amp;rsquo;s requested.&lt;/p&gt;

&lt;p&gt;The second interesting difference is that we have much less control over how much data we&amp;rsquo;re going to read. When the socket tells us that there&amp;rsquo;s data available, it doesn&amp;rsquo;t tell us how much. That means that in the above code, we can easily end up in a situation where &lt;code&gt;bytesRead &amp;lt; count&lt;/code&gt;: indeed, it will happen whenever the kernel buffer had fewer bytes available than we requested. This is in contrast with blocking file I/O, where the only time &lt;code&gt;bytesRead &amp;lt; count&lt;/code&gt; occurs is when we&amp;rsquo;ve reached the end of the file.&lt;/p&gt;

&lt;p&gt;Finally, I want to draw attention to the different way in which buffers are provided in the two scenarios. With files, since we are doing blocking I/O in a threadpool, we need to provide the buffer up front. Whereas with sockets, we can wait until the last minute to do so. This had a pretty drastic impact on the API surface when we tried to express the reuslt in JavaScript. In particular, while you could imagine a way to wrap up our JavaScript socket API into something like our JavaScript file API, you can&amp;rsquo;t really do the other way around.&lt;/p&gt;
</description>
        <pubDate>Mon, 16 Mar 2015 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/reading-from-sockets/</link>
        <guid isPermaLink="true">https://blog.domenic.me/reading-from-sockets/</guid>
        
        
        <category>Streams</category>
        
      </item>
    
      <item>
        <title>Reading from Files</title>
        <description>&lt;p&gt;&lt;em&gt;This post is part of a series on the byte sources underlying the readable streams in the Streams Standard. See &lt;a href=&quot;/byte-sources-introduction/&quot;&gt;the introductory post&lt;/a&gt; for more background and links to the rest of the series.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Once you have opened a file descriptor, you&amp;rsquo;ll use the &lt;a href=&quot;http://linux.die.net/man/2/read&quot;&gt;read(2)&lt;/a&gt; function to read bytes from it. In C the signature is&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;ssize_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Translated into JavaScript this might look something like&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bytesRead&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;readInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which will attempt to read &lt;code&gt;count&lt;/code&gt; bytes into the &lt;code&gt;ArrayBuffer&lt;/code&gt; &lt;code&gt;buffer&lt;/code&gt;, starting at position &lt;code&gt;offset&lt;/code&gt; into the &lt;code&gt;ArrayBuffer&lt;/code&gt;. The returned number of bytes, &lt;code&gt;bytesRead&lt;/code&gt;, might be less than the desired &lt;code&gt;count&lt;/code&gt;, usually because you&amp;rsquo;ve reached the end of the file.&lt;/p&gt;

&lt;p&gt;The most interesting thing to note about read(2) is that it is blocking. So our above naive translation into JavaScript would actually lock up your browser or server for the amount of time the I/O happens. This is obviously a no-go if you&amp;rsquo;re trying to write a server that serves more than one user in parallel, or trying to create a responsive 60 fps web page.&lt;/p&gt;

&lt;p&gt;But of course we know how to fix this. We&amp;rsquo;ll just turn it into a promise-returning function:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;readInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bytesRead&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Not so fast. How exactly do we plan on translating a blocking POSIX API into a non-blocking JavaScript API? The obvious answer is to use another thread. That is, off in a background thread, we pass the memory represented by &lt;code&gt;buffer&lt;/code&gt; into read(2), and when read(2) finishes, we go back to the main thread and fulfill the promise we previously vended with read(2)&amp;rsquo;s return value.&lt;/p&gt;

&lt;p&gt;This solution has a major issue, however: &lt;strong&gt;data races&lt;/strong&gt;. That is, it makes it possible to observe the memory in &lt;code&gt;buffer&lt;/code&gt; changing out from under us, with code like the following:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;view&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Uint8Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;readInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bytesRead&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Because the memory in &lt;code&gt;buffer&lt;/code&gt; is being filled in by read(2) in the background thread, it&amp;rsquo;s possible for this program to output &lt;code&gt;false&lt;/code&gt;! Oh no!&lt;/p&gt;

&lt;p&gt;In the io.js world, this is considered OK, and with some effort you can create situations like this using their native &lt;code&gt;Buffer&lt;/code&gt; type. However, in the world of web browsers, and in general in any world where standards bodies need to get multiple vendors to agree, this is not going to fly. JavaScript&amp;rsquo;s execution model is strongly based around a run-to-completion single-threaded paradigm, and if we poke holes in that by letting other threads modify our variables out from under us between two execution steps, all hell can break lose. No specs, libraries, or optimizing compilers are written to accomodate such a world.&lt;/p&gt;

&lt;p&gt;One proposed solution would be to &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer/transfer&quot;&gt;&lt;em&gt;transfer&lt;/em&gt;&lt;/a&gt; the backing memory of the &lt;code&gt;ArrayBuffer&lt;/code&gt; into a new &lt;code&gt;ArrayBuffer&lt;/code&gt; that is only accessible once the read(2) call has finished. In code, that might look something like this:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;readInto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(({&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bytesRead&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// `result` is backed by the same memory `buffer` used to be&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// backed by, but they are not equal:&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// `buffer`&#39;s backing memory has now been transferred, so trying to use&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// `buffer` directly (or any views onto `buffer`) will throw:&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;throws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;byteLength&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;throws&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Uint8Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note how once &lt;code&gt;buffer&lt;/code&gt; has been transferred, the &lt;code&gt;buffer&lt;/code&gt; instance itself is now useless: it is &amp;ldquo;detached&amp;rdquo; in spec terms.&lt;/p&gt;

&lt;p&gt;We could also imagine other ways of avoiding the data races. For example, if we had an API that allowed the background thread to first detach, then &amp;ldquo;reattach,&amp;rdquo; the backing memory to &lt;code&gt;buffer&lt;/code&gt;, we wouldn&amp;rsquo;t need the separate &lt;code&gt;buffer&lt;/code&gt; and &lt;code&gt;result&lt;/code&gt; variables pointing to the same backing memory. Ideally such an API would allow us to detach and reattach &lt;em&gt;sections&lt;/em&gt; of the &lt;code&gt;ArrayBuffer&lt;/code&gt;, so that I could (for example) read multiple files in parallel into different sections of one large buffer. &lt;a href=&quot;https://esdiscuss.org/topic/improving-detachment-for-array-buffers&quot;&gt;I proposed this on es-discuss&lt;/a&gt;, but nobody seemed to be interested.&lt;/p&gt;

&lt;p&gt;Alternately, we could decide that for a low-level JavaScript API representing a file descriptor, data races are OK after all. In that case, &lt;a href=&quot;https://blog.mozilla.org/javascript/2015/02/26/the-path-to-parallel-javascript/&quot;&gt;Mozilla&amp;rsquo;s &lt;code&gt;SharedArrayBuffer&lt;/code&gt; proposal&lt;/a&gt; would be a good fit—we&amp;rsquo;ll just write to the shared array buffer in the background thread, while still allowing reading in the main thread. As mentioned before, it might be hard to get such a primitive past multiple vendors and into the relevant standards. But the desire to transpile threaded C and C++ code into asm.js is proving to be a powerful motivator, which might push it into acceptance.&lt;/p&gt;
</description>
        <pubDate>Thu, 05 Mar 2015 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/reading-from-files/</link>
        <guid isPermaLink="true">https://blog.domenic.me/reading-from-files/</guid>
        
        
        <category>Streams</category>
        
      </item>
    
      <item>
        <title>Byte Sources: Introduction</title>
        <description>&lt;p&gt;&lt;em&gt;This post is the beginning of a series of posts regarding some of the more interesting issues I&amp;rsquo;ve encountered while working on the Streams Standard.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;In the &lt;a href=&quot;http://streams.spec.whatwg.org/&quot;&gt;Streams Standard&lt;/a&gt; we have the concept of readable streams, which are an abstraction on top of the lower-level &lt;strong&gt;underlying sources&lt;/strong&gt;. In an abstract sense an underlying source is &amp;ldquo;where the chunks of data come from.&amp;rdquo; The most basic underlying sources are things like files or HTTP connections. (More complicated ones could be e.g. an underlying source that randomly generates data in-memory for test purposes, or one that synthesizes data from multiple concrete locations.) These basic underlying sources are concerned with direct production of bytes.&lt;/p&gt;

&lt;p&gt;The major goal of the Streams Standard is to provide an efficient abstraction specifically for I/O. Thus, to design a suitable readable stream abstraction, we can&amp;rsquo;t just think about general concepts of &lt;a href=&quot;https://github.com/kriskowal/gtor/&quot;&gt;reactivity&lt;/a&gt; or &lt;a href=&quot;https://github.com/zenparsing/async-iteration/&quot;&gt;async iterables&lt;/a&gt; or &lt;a href=&quot;https://github.com/jhusain/asyncgenerator#introducing-observable&quot;&gt;observables&lt;/a&gt;. We need to dig deeper into how, exactly, the underlying sources will work. Otherwise we might find ourselves &lt;a href=&quot;https://github.com/whatwg/streams/issues/253&quot;&gt;scrambling&lt;/a&gt; to reform the API at the last minute when confronted with real-world implementation challenges. (Oops.)&lt;/p&gt;

&lt;p&gt;The current revision of the standard describes underlying sources as belonging to two broad categories: push sources, where data is constantly flowing in, and pull sources, where you specifically request it. The prototypal examples of these categories are TCP sockets and file descriptors. Once a TCP connection is open, the remote server will begin pushing data to you. Whereas, with a file, until you ask the OS to do a read, no I/O happens.&lt;/p&gt;

&lt;p&gt;This division is conceptually helpful, but it&amp;rsquo;s instructive to go deeper and look at the actual system APIs in play here. Given that concepts like &amp;ldquo;events&amp;rdquo; are way too high-level for an OS API, they end up being shaped quite differently than how you might imagine. We&amp;rsquo;ll assume a POSIX environment for most of this series, but I&amp;rsquo;d like to talk about some Windows specifics toward the end. Along the way we&amp;rsquo;ll continually be trying to bridge the gap between these C APIs and how they might manifest in JavaScript, both to give the less-C-inclined readers a chance, and to illustrate the issues we&amp;rsquo;ve been wrestling with in the Streams Standard.&lt;/p&gt;

&lt;p&gt;So far these are the episodes I have planned:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Byte sources: introduction (this post)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/reading-from-files/&quot;&gt;Reading from files&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/reading-from-sockets/&quot;&gt;Reading from sockets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Byte source APIs on Windows&lt;/li&gt;
&lt;li&gt;Byte source APIs in libuv and io.js&lt;/li&gt;
&lt;li&gt;Readable streams&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I will update this post with links to them as they become available.&lt;/p&gt;
</description>
        <pubDate>Wed, 04 Mar 2015 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/byte-sources-introduction/</link>
        <guid isPermaLink="true">https://blog.domenic.me/byte-sources-introduction/</guid>
        
        
        <category>Streams</category>
        
      </item>
    
      <item>
        <title>The Revealing Constructor Pattern</title>
        <description>&lt;p&gt;I want to document an interesting pattern we&amp;rsquo;ve seen emerge in some recent web platform specs, including &lt;a href=&quot;https://people.mozilla.org/%7Ejorendorff/es6-draft.html#sec-promise-objects&quot;&gt;promises&lt;/a&gt; and &lt;a href=&quot;https://github.com/whatwg/streams&quot;&gt;streams&lt;/a&gt;. I&amp;rsquo;m calling it the &lt;strong&gt;revealing constructor pattern&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;the-promises-example&quot;&gt;The Promises Example&lt;/h2&gt;

&lt;p&gt;Let&amp;rsquo;s take the case of promises first, since that may be familiar. You can construct a new promise like so:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Use `resolve` to resolve `p`.&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Use `reject` to reject `p`.&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We see here that the &lt;code&gt;Promise&lt;/code&gt; constructor takes a single function as its sole parameter (called the &amp;ldquo;executor function&amp;rdquo;). It then &lt;em&gt;immediately&lt;/em&gt; calls that function with two arguments, &lt;code&gt;resolve&lt;/code&gt; and &lt;code&gt;reject&lt;/code&gt;. These arguments have the capability to manipulate the internal state of the newly-constructed &lt;code&gt;Promise&lt;/code&gt; instance &lt;code&gt;p&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;I call this the revealing constructor pattern because the &lt;code&gt;Promise&lt;/code&gt; constructor is &lt;em&gt;revealing&lt;/em&gt; its internal capabilities, but only to the code that constructs the promise in question. The ability to resolve or reject the promise is only revealed to the constructing code, and is crucially &lt;em&gt;not&lt;/em&gt; revealed to anyone &lt;em&gt;using&lt;/em&gt; the promise. So if we hand off &lt;code&gt;p&lt;/code&gt; to another consumer, say&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;doThingsWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;then we can be sure that this consumer cannot mess with any of the internals that were revealed to us by the constructor. This is as opposed to, for example, putting &lt;code&gt;resolve&lt;/code&gt; and &lt;code&gt;reject&lt;/code&gt; methods on &lt;code&gt;p&lt;/code&gt;, which anyone could call. (And no, adding underscores to the beginning of your method names won&amp;rsquo;t save you.)&lt;/p&gt;

&lt;h2 id=&quot;historical-origins&quot;&gt;Historical Origins&lt;/h2&gt;

&lt;p&gt;The first place anyone can remember seeing this pattern is &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/apps/br211866.aspx&quot;&gt;in the WinJS promise implementation&lt;/a&gt;. Before that, promise libraries used an awkward concept called a &amp;ldquo;deferred.&amp;rdquo; You would do something like this:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;deferred&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Q&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;defer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;deferred&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Use `deferred.resolve` to resolve `p`.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Use `deferred.reject` to reject `p`.&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;doThingsWith&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This was strange in a few ways, but most prominently, it was strange because you were constructing an object without using a constructor. This is generally an antipattern in JavaScript: we want to be able to clearly conceptualize the relationship between instances, constructor functions, and prototypes.&lt;/p&gt;

&lt;p&gt;In contrast, with the revealing constructor pattern, we get our nice constructor invariants back. Things like:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;constructor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getPrototypeOf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These are all signs that you&amp;rsquo;re dealing with a well-designed &amp;ldquo;class&amp;rdquo; in JavaScript, that will behave as you expect.&lt;/p&gt;

&lt;h2 id=&quot;the-streams-example&quot;&gt;The Streams Example&lt;/h2&gt;

&lt;p&gt;When putting together &lt;a href=&quot;htwetps://github.com/whatwg/streams&quot;&gt;the in-progress streams spec&lt;/a&gt;, we of course drew a lot of inspiration from &lt;a href=&quot;http://nodejs.org/api/stream.html&quot;&gt;Node streams&lt;/a&gt;. But Node streams do things kind of strangely, with regard to vending their capabilities.&lt;/p&gt;

&lt;p&gt;To produce a Node stream representing a specific resource—which is somewhat analogous to producing a promise representing a specific asynchronous operation—you don&amp;rsquo;t use the stream constructor. You don&amp;rsquo;t even use something like the deferred pattern. Instead, you &lt;em&gt;subclass&lt;/em&gt; the appropriate stream class. And then you overwrite certain underscore-prefixed methods!&lt;/p&gt;

&lt;p&gt;So for a simplified example, here is how you would create a file reader stream using the Node APIs. I&amp;rsquo;ll use ES6 class syntax for brevity, but that is just sugar over the usual ES5 incantations.&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FileReaderStream&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Readable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;nx&quot;&gt;_read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Use `this.filename` to eventually call `this.push(chunk)`&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// with some data from the file, or `this.push(null)` to close&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// the stream, or `this.emit(&quot;error&quot;, e)` with an error.&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;myNodeStream&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FileReaderStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/path/to/file.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are two interesting actors here:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;_read&lt;/code&gt;, a method not meant to be called by users directly, but instead called by the internals of the stream when it&amp;rsquo;s time to read data from the underlying source.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;push&lt;/code&gt; and &lt;code&gt;emit(&amp;quot;error&amp;quot;, e)&lt;/code&gt;, which have the capability to manipulate the stream&amp;rsquo;s internal buffer and state machine. They too are not meant to be called by users directly, but instead only by implementers, inside their &lt;code&gt;_read&lt;/code&gt; method (or perhaps inside the constructor).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Interestingly, these are almost exactly analogous to the promise situation. &lt;code&gt;_read&lt;/code&gt; is like the executor argment passed to the promise constructor, in that it consists of user code that does the actual work. And &lt;code&gt;push&lt;/code&gt;/&lt;code&gt;emit&lt;/code&gt; are capabilities, like &lt;code&gt;resolve&lt;/code&gt;/&lt;code&gt;reject&lt;/code&gt;, which can be used by the work-doing function to manipulate internal state.&lt;/p&gt;

&lt;p&gt;In building the streams spec, we realized the Node pattern wasn&amp;rsquo;t the way we wanted to go. Requiring subclassing for every stream instance is not ergonomic. Using underscore-prefixed methods as the extension point isn&amp;rsquo;t realistic either. And letting any user access the capabilities involved is not tenable, in part because it means implementations can&amp;rsquo;t build invariants around who has access to the internal buffer.&lt;/p&gt;

&lt;p&gt;In contrast, the revealing constructor pattern works out really well. To create a file reader stream with whatwg/streams, you do something like&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;createFileReaderStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ReadableStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;pull&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;enqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// Use `filename` to eventually call `enqueue(chunk)`&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// with some data from the file, or `close()` to&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// close the stream, or `error(e)` with an error.&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;myWhatwgStream&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;createFileReaderStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/path/to/file.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Notice the difference in the external API exposed. If you pass &lt;code&gt;myNodeStream&lt;/code&gt; to another function, that function can mess with the stream&amp;rsquo;s internal state as much as it wants, calling &lt;code&gt;push&lt;/code&gt;, emitting &lt;code&gt;&amp;quot;error&amp;quot;&lt;/code&gt; events, or even (despite the underscore) calling &lt;code&gt;_read&lt;/code&gt;. Whereas if you pass &lt;code&gt;myWhatwgStream&lt;/code&gt; around, consumers will not be able to do any of those things: the integrity of its internal state will be preserved.&lt;/p&gt;

&lt;p&gt;(Plus, no subclassing!)&lt;/p&gt;

&lt;h2 id=&quot;when-would-i-use-this&quot;&gt;When Would I Use This?&lt;/h2&gt;

&lt;p&gt;I admit that that the revealing constructor pattern seems a bit unorthodox. The number of actors involved—viz. the constructor itself, the work-doing function to which capabilities are given, and the capability arguments—can be hard to get your head around, at least the first few times you see them.&lt;/p&gt;

&lt;p&gt;That said, it is a pretty elegant solution to a tricky problem. You might not need this level of encapsulation in your home-grown code. And even more widespread libraries may be able to skate by, as Node does, with documentation strategies and an attitude of &amp;ldquo;don&amp;rsquo;t do anything dumb with the capabilities we leave lying around, or it&amp;rsquo;ll break.&amp;rdquo; But when writing platform-level libraries and abstractions, which need to maintain their integrity in the face of any environment, the revealing constructor pattern really proves its worth.&lt;/p&gt;

&lt;p&gt;And besides, patterns become part of our vernacular. Many patterns that are commonplace today seemed just as strange when they are introduced as the revealing constructor pattern might to you now. After working with promises and streams for a while, you might encounter a situation where a revealing constructor is a natural fit for your library&amp;rsquo;s needs. Who knows!&lt;/p&gt;

&lt;h2 id=&quot;postscript&quot;&gt;Postscript&lt;/h2&gt;

&lt;p&gt;If those examples weren&amp;rsquo;t enough, here&amp;rsquo;s one that you should be able to connect with: &lt;a href=&quot;https://gist.github.com/domenic/9003334&quot;&gt;an event emitter using the revealing constructor pattern&lt;/a&gt;. This is an evolution of some of my &lt;a href=&quot;https://github.com/domenic/pubit&quot;&gt;earlier work&lt;/a&gt; on event emitters with separate capabilities.&lt;/p&gt;
</description>
        <pubDate>Fri, 14 Feb 2014 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/the-revealing-constructor-pattern/</link>
        <guid isPermaLink="true">https://blog.domenic.me/the-revealing-constructor-pattern/</guid>
        
        
        <category>JavaScript</category>
        
        <category>Promises</category>
        
        <category>Streams</category>
        
      </item>
    
      <item>
        <title>Continual Progress in the W3C TAG</title>
        <description>&lt;p&gt;The W3C Technical Architecture Group has made immeasurable progress this year since
&lt;a href=&quot;http://infrequently.org/2012/12/reforming-the-w3c-tag/&quot;&gt;the original wave of reformist thought&lt;/a&gt; swept through it last
election season. The extensible web agenda, which I&amp;rsquo;ve
&lt;a href=&quot;http://domenic.me/2013/10/07/the-extensible-web/&quot;&gt;spoken about previously&lt;/a&gt;, has been adopted into their vision for the
web&amp;rsquo;s foundations and informed recent spec work across the W3C. The TAG even moved its deliverables
&lt;a href=&quot;https://github.com/w3ctag/&quot;&gt;onto GitHub&lt;/a&gt;, allowing better collaboration with and transparency to developers.&lt;/p&gt;

&lt;p&gt;But there&amp;rsquo;s always more to do. The web is slowly but surely coming into its own as a serious modern development
platform—one which can compete with native apps across the board. New APIs, new primitives, and new tools are very much
necessary to make our open platform as attractive to developers and users as it could be. To lure them away from the
walled gardens of closed app stores and vendor-proprietary development platforms, we must provide something better.&lt;/p&gt;

&lt;p&gt;The TAG is in a unique position to oversee these efforts, with its charter to steward the evolution of web architecture
and coordinate with other relevant groups like Ecma TC39 and the IETF. As such, I&amp;rsquo;m excited to be
&lt;a href=&quot;http://lists.w3.org/Archives/Public/www-tag/2013Dec/0004.html&quot;&gt;running for TAG membership&lt;/a&gt; in this
&lt;a href=&quot;http://www.w3.org/blog/TAG/2013/11/06/tag-election-2013/&quot;&gt;newest election cycle&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Over the last year of my increasing involvement in web standards, I&amp;rsquo;ve found two things to be paramount: &lt;em&gt;developer
involvement&lt;/em&gt;, and &lt;em&gt;a focus on solid low-level primitives&lt;/em&gt;. Independent of any formal role in the process, I have and
will continue to champion these causes. My nomination by the jQuery Foundation to serve on the TAG only allows me to
advocate them in a more formal role.&lt;/p&gt;

&lt;p&gt;As a web developer myself, I experience the joys and disappointments of our platform every day. Some of you might think
it&amp;rsquo;s all disappointments—and I can certainly sympathize, given our
&lt;a href=&quot;https://twitter.com/domenic/status/403668805542354944&quot;&gt;day-to-day frustrations&lt;/a&gt;. But one of the more eye-opening
experiences of the last few months has been working alongside an experienced Java developer, new to the web platform,
and seeing his almost childlike glee at how &lt;em&gt;easy&lt;/em&gt; it is to produce complex, interactive, and robust UIs. More
generally, when I think on what I actually do for a living at Lab49—produce complex financial trading and analysis
systems, built on the open web platform—it&amp;rsquo;s hard not to be amazed. We&amp;rsquo;ve come a long way from the time when only
desktop apps were considered for serious work. Now all our clients want cross-browser and cross-device web applications,
that they can access from any computer at any time, with shareable URLs and responsive experiences and all the other
things that come with the web.&lt;/p&gt;

&lt;p&gt;To enable developers to build such increasingly powerful experiences, we need to listen to them. That&amp;rsquo;s why I spend a
lot of time speaking at and traveling to developer conferences, or being involved on Twitter, on IRC, and on GitHub,
with the community. I recently gave a talk specifically on
&lt;a href=&quot;https://www.youtube.com/watch?v=hneN6aW-d9w&amp;amp;hd=1&quot;&gt;how to get involved in web standards&lt;/a&gt;, and have been working
constantly to get developer feedback on missing features or in-progress specs since then.&lt;/p&gt;

&lt;p&gt;Developers are a tricky bunch, as many have been trained to ignore standards bodies and simply hack together their own
solutions. They&amp;rsquo;re used to being ignored themselves. But times are changing. The
&lt;a href=&quot;http://extensiblewebmanifesto.org/&quot;&gt;extensible web manifesto&lt;/a&gt; guides us to supply the web with the low-level features
developers need, and then to listen to them and roll what they build back into the platform. The TAG&amp;rsquo;s role is helping
to guide this overall process, and I hope to bring along my experience listening to and learning from the developer
community.&lt;/p&gt;

&lt;p&gt;You may have noticed I kept saying &amp;ldquo;developers&amp;rdquo; above, and never &amp;ldquo;web developers.&amp;rdquo; That&amp;rsquo;s because I strongly believe we
need to look outside our own community for inspiration. There are lessons to be learned everywhere across the software
development landscape, from other UI frameworks and standard libraries, to other languages whose features we need in our
platform&amp;rsquo;s &lt;em&gt;lingua franca&lt;/em&gt; of JavaScript. Perhaps most importantly, I maintain strong ties with and involvement in the
Node.js community. They provide an excellent source of inspiration and advice, as a platform that takes JavaScript far
beyond where many of us would have envisioned it only a few years ago.&lt;/p&gt;

&lt;p&gt;Which brings us to the issue of low-level primitives. Node&amp;rsquo;s great success comes in a large part from its focus on
providing such primitives: things like standard patterns for binary data, for asynchrony, or for streaming. On top of
these they&amp;rsquo;ve built &lt;a href=&quot;http://nodejs.org/api/&quot;&gt;a standard library&lt;/a&gt; that should be the envy of any platform in both its
small size and in its power.&lt;/p&gt;

&lt;p&gt;Of course, the web platform must by necessity evolve via consensus, and so more slowly than Node. But this gives us the
benefit of watching them run out ahead of us, make mistakes, and then come back with field reports on how it went. As
such we are getting typed arrays instead of buffers; promises instead of error-first callbacks; and
&lt;a href=&quot;https://github.com/whatwg/streams/&quot;&gt;intelligently-designed streams&lt;/a&gt; instead of backward-compatible evolved ones. And
it&amp;rsquo;s no coincidence that I&amp;rsquo;ve been involved in both the promises and streams efforts, as I&amp;rsquo;m very passionate about
ensuring that these foundational pieces of the platform are solid enough to build on and have learned from experiences
implementing them elsewhere.&lt;/p&gt;

&lt;p&gt;But we&amp;rsquo;re still in our infancy when it comes to building on these primitives. We need to tie them together with the rest
of the web platform. In short, we need to get to the day when the&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://example.com/video.mp4&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;videoProcessingWebWorker&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;video&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/whatwg/streams/blob/master/Requirements.md#you-must-be-able-to-transform-streams-via-the-pipe-chain&quot;&gt;example&lt;/a&gt;
is not just a dream, but is reality.&lt;/p&gt;

&lt;p&gt;In my view, it&amp;rsquo;s the TAG&amp;rsquo;s job to get us there. The cross-group coordination issues necessary to make visions like this
a reality are a large part of the TAG&amp;rsquo;s charter. We can provide a high-level vision, fueled by our interaction with the
developer community, for extending the web forward. And all the while, I&amp;rsquo;ll be down in the trenches, both gathering
feedback to help shape this vision, and working on specifications and interfacing with implementers to make it happen.&lt;/p&gt;

&lt;p&gt;If this sounds like progress to you, I&amp;rsquo;d appreciate your organization&amp;rsquo;s vote.&lt;/p&gt;
</description>
        <pubDate>Mon, 02 Dec 2013 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/continual-progress-in-the-w3c-tag/</link>
        <guid isPermaLink="true">https://blog.domenic.me/continual-progress-in-the-w3c-tag/</guid>
        
        
        <category>Web</category>
        
      </item>
    
      <item>
        <title>The Extensible Web</title>
        <description>&lt;p&gt;&lt;em&gt;This post adapts &lt;a href=&quot;http://2013.jsconf.eu/speakers/#/speakers/domenic-denicola-the-extensible-web-javascript-all-the-way-down&quot;&gt;my talk from JSConf EU 2013&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The web platform has, historically, been somewhat of a kludge. It&amp;rsquo;s grown, organically, into something with no real
sense of cohesion. Most of its APIs have been poorly designed, by C++ developers, via
&lt;a href=&quot;http://www.omg.org/gettingstarted/omg_idl.htm&quot;&gt;a binding layer meant originally for CORBA&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Worse, there have been major gaps in what we can do compared to native apps. And for those things that we can do, we end
up accomplishing them by drowning ourselves in custom JavaScript functionality.&lt;/p&gt;

&lt;p&gt;The problem is in the process. Generally, new things have been introduced into our web platform via a months or years of
mailing-list standardization, writing something in prose and IDL, driven by scenario-solving—without much concern for
actual utility, much less usability. Implementers expose some fundamental capability in terms of a high-level API or
declarative form that burrows down directly to the C++ layer, giving you limited customizability. After all this time,
it eventually ends up in your hands, and you end up telling the standards bodies that &lt;a href=&quot;https://dvcs.w3.org/hg/IndexedDB/raw-file/default/Overview.html&quot;&gt;it&amp;rsquo;s a huge mess&lt;/a&gt;, or
that &lt;a href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/offline.html&quot;&gt;it solves half of your problems half of the time&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Despite all this, we&amp;rsquo;ve somehow done OK. Actually, a bit more than OK, given that the web is the most successful
platform ever. How did we manage this?&lt;/p&gt;

&lt;p&gt;Well, we wrap up APIs with horrible usability into ones that are quite pleasant, like jQuery. We &amp;ldquo;prolyfill,&amp;rdquo; creating
libraries like Sizzle to implement CSS selector matching, or libraries like Angular to implement custom elements, in the
hope that eventually native support will appear. We transpile from languages like CoffeeScript or SASS to add new
features to our authoring languages. And one case, promises, we even
&lt;a href=&quot;http://www.slideshare.net/domenicdenicola/boom-promisesa-was-born&quot;&gt;built an interoperable standard from the ground up&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We need our platform to be better, and so we &lt;em&gt;make&lt;/em&gt; it better, by ourselves.&lt;/p&gt;

&lt;h2 id=&quot;the-extensible-web-manifesto&quot;&gt;The Extensible Web Manifesto&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&quot;http://extensiblewebmanifesto.org/&quot;&gt;Extensible Web Manifesto&lt;/a&gt; is standards bodies saying they&amp;rsquo;re ready to do
their part. Until now, we, the developers, have been shouldering all the work, writing massive JavaScript libraries or
transpilers to reinvent basic functionality.&lt;/p&gt;

&lt;p&gt;There&amp;rsquo;s a better way, where we work together toward the future.&lt;/p&gt;

&lt;p&gt;What these standards bodies have realized is that the web platform is our language, but like all languages, it must
evolve.&lt;/p&gt;

&lt;p&gt;This evolution of our shared language takes place in two acts:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;extending our basic vocabulary;&lt;/li&gt;
&lt;li&gt;starting to &lt;a href=&quot;http://briankardell.wordpress.com/2013/05/17/dropping-the-f-bomb/&quot;&gt;incorporate &amp;ldquo;slang&amp;rdquo;&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;extending-our-vocabulary&quot;&gt;Extending our Vocabulary&lt;/h2&gt;

&lt;p&gt;Extending our vocabulary means two things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;Explaining the features of the platform that are already there.&lt;/em&gt; Wouldn&amp;rsquo;t it be weird if we had compound words like
&amp;ldquo;scifi,&amp;rdquo; but didn&amp;rsquo;t have the words &amp;ldquo;science&amp;rdquo; or &amp;ldquo;fiction&amp;rdquo;? If some standards body, perhaps the
&lt;a href=&quot;https://en.wikipedia.org/wiki/Acad%C3%A9mie_fran%C3%A7aise&quot;&gt;French Making Up Words Consortium&lt;/a&gt;, just handed us the
word &amp;ldquo;sandpaper,&amp;rdquo; but we had no way in our language to talk about &amp;ldquo;sand&amp;rdquo; or &amp;ldquo;paper&amp;rdquo; individually? The web is like
that today, and we&amp;rsquo;ll go over a few examples.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;Giving you new low-level features that you can use&lt;/em&gt;. If you wanted to invent the word &amp;ldquo;scifi,&amp;rdquo; somebody had better
have come up with the words for &amp;ldquo;science&amp;rdquo; and &amp;ldquo;fiction&amp;rdquo;! Similarly, there&amp;rsquo;s lots of things we just don&amp;rsquo;t have &amp;ldquo;words&amp;rdquo;
for on the web, yet. That&amp;rsquo;s where native apps are hurting us.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So with this in mind, let&amp;rsquo;s look at some examples.&lt;/p&gt;

&lt;h3 id=&quot;custom-elements&quot;&gt;Custom Elements&lt;/h3&gt;

&lt;p&gt;The most fundamental unexplained gap in the platform is simply: how do those damn elements even work?&lt;/p&gt;

&lt;p&gt;Somehow, you feed a string containing some angle brackets into the browser, and they get turned into these JS objects
with terrific APIs, which we call &amp;ldquo;the DOM.&amp;rdquo; How did that happen?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dvcs.w3.org/hg/webcomponents/raw-file/default/spec/custom/index.html&quot;&gt;Custom elements&lt;/a&gt; explain this process,
saying that you register a mapping of tag names to element prototypes with the browser, and that&amp;rsquo;s what the HTML parser
is actually using under the hood. This is great! This is the democratization of HTML!&lt;/p&gt;

&lt;p&gt;And better yet, this means no more crazy widget libraries with their own crazy semantics. No more jQuery UI with its
&lt;code&gt;.option&lt;/code&gt; thing (sometimes a setter, sometimes a getter, sometimes a method call); no more Dojo digits; no more
Bootstrap craziness; no more WinJS with its funky &lt;code&gt;winControl&lt;/code&gt; property. Just tags, that turn into elements, which
behave like you&amp;rsquo;d expect: they have properties, getters, setters, methods, and all that.&lt;/p&gt;

&lt;h3 id=&quot;the-shadow-dom&quot;&gt;The Shadow DOM&lt;/h3&gt;

&lt;p&gt;But what about the existing tags? Half of the reason these widget libraries exist is so that you can create your own
stupid &lt;code&gt;&amp;lt;select&amp;gt;&lt;/code&gt; element, because the existing one isn&amp;rsquo;t styleable or customizable.&lt;/p&gt;

&lt;p&gt;In general, think of all the &amp;ldquo;magic&amp;rdquo; tags that exist today, like &lt;code&gt;&amp;lt;select&amp;gt;&lt;/code&gt;, or &lt;code&gt;&amp;lt;input type=&amp;quot;date&amp;quot;&amp;gt;&lt;/code&gt;, or &lt;code&gt;&amp;lt;details&amp;gt;&lt;/code&gt;,
or &lt;code&gt;&amp;lt;video&amp;gt;&lt;/code&gt;, or even good old &lt;code&gt;&amp;lt;li&amp;gt;&lt;/code&gt;, whose bullet seems to come out of nowhere. In all cases, there&amp;rsquo;s some extra
&amp;ldquo;stuff&amp;rdquo; the browser is creating, and allowing users to interact with, and sometimes even allowing you to style via
ridiculous vendor-prefixed pseudo-elements like &lt;code&gt;::-moz-placeholder&lt;/code&gt;. But where does this extra stuff live?&lt;/p&gt;

&lt;p&gt;The answer is: in the &lt;a href=&quot;https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html&quot;&gt;shadow DOM&lt;/a&gt;. And what&amp;rsquo;s
great about the shadow DOM, is that once we actually have a realistic basis for these hidden parts of the DOM, in
reality instead of in C++ magic-land, you&amp;rsquo;ll be able to actually start hooking into them instead of rebuilding an entire
element just to customize its behavior and styling. That day is
&lt;a href=&quot;https://groups.google.com/a/chromium.org/d/msg/blink-dev/ZAdZJWahyF8/lOInKCTbmrUJ&quot;&gt;almost here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;web-audio&quot;&gt;Web Audio&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&quot;https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html&quot;&gt;web audio API&lt;/a&gt; is a good example of both
facets of the &amp;ldquo;new vocabulary&amp;rdquo; theme. You can do fundamentally new things with web audio, like positional audio or audio
synthesis or so many other cool possibilities.&lt;/p&gt;

&lt;p&gt;But remember the &lt;code&gt;&amp;lt;audio&amp;gt;&lt;/code&gt; tag, from way back in 2009? It&amp;rsquo;s kind of the quintessential instance of &amp;ldquo;here&amp;rsquo;s some C++
magic thrown over the wall to you web developers; have fun!&amp;rdquo; Well, from an extensible web perspective, the &lt;code&gt;&amp;lt;audio&amp;gt;&lt;/code&gt; tag
should be explained in terms of web audio.&lt;/p&gt;

&lt;h3 id=&quot;etcetera&quot;&gt;Etcetera&lt;/h3&gt;

&lt;p&gt;There are of course many other APIs which exist solely to expose a new low-level hardware or platform feature to the web
platform. One of the older examples on the hardware side is the
&lt;a href=&quot;http://www.w3.org/TR/geolocation-API/&quot;&gt;geolocation API&lt;/a&gt;. On the software side, good examples include the
&lt;a href=&quot;http://notifications.spec.whatwg.org/&quot;&gt;notifications API&lt;/a&gt; and &lt;a href=&quot;http://fullscreen.spec.whatwg.org/&quot;&gt;fullscreen API&lt;/a&gt;. But
more and more are popping up as we attempt to close all the gaps preventing full parity with native apps; one particular
driver of this is the work on Firefox OS and the related &lt;a href=&quot;http://www.w3.org/2009/dap/&quot;&gt;device APIs&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;es6-and-es7&quot;&gt;ES6 and ES7&lt;/h3&gt;

&lt;p&gt;Finally, I want to call out ECMAScript 6 (which is nearing finalization) and ECMAScript 7 (for which efforts are just
starting to ramp up). Extending the web&amp;rsquo;s programming language is adding new vocabulary at its most literal level, and
the TC39 committee driving the evolution of ECMAScript does not disappoint in their efforts here.&lt;/p&gt;

&lt;p&gt;In ES6 we&amp;rsquo;ll be getting subclassable built-in objects, so that you can finally extend &lt;code&gt;Array&lt;/code&gt; or &lt;code&gt;Date&lt;/code&gt; or the new &lt;code&gt;Map&lt;/code&gt;
and &lt;code&gt;Set&lt;/code&gt; types, in a way that actually works. We&amp;rsquo;ll also be getting proxies, which allow an object almost-complete
control over the meta-object protocol underlying all interactions with it. And for ES7, the proposal for
&lt;code&gt;Object.observe&lt;/code&gt; is starting to firm up. Plus there is talk of adding weak references to the language, now that some of
their trickier aspects have been worked out.&lt;/p&gt;

&lt;h2 id=&quot;incorporating-slang&quot;&gt;Incorporating Slang&lt;/h2&gt;

&lt;p&gt;The second half of the extensible web philosophy is that we need to tighten the feedback loop between developers and
standards bodies.&lt;/p&gt;

&lt;p&gt;Think about it: you get all these neat new low-level tools, and you build great things out of them. But you end up
downloading megabytes of JavaScript, or transpiling your code, just to get the base platform in place. This is why
almost every web page uses jQuery: because the platform itself hasn&amp;rsquo;t stepped up to the plate and incorporated jQuery&amp;rsquo;s
innovations back in.&lt;/p&gt;

&lt;p&gt;In short, we need to incorporate this kind of invented &amp;ldquo;slang&amp;rdquo; back into our shared language. Let&amp;rsquo;s take a look at some
of the examples of this so far.&lt;/p&gt;

&lt;h3 id=&quot;lt-template-gt&quot;&gt;&lt;code&gt;&amp;lt;template&amp;gt;&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webcomponents/template/&quot;&gt;&lt;code&gt;&amp;lt;template&amp;gt;&lt;/code&gt; element&lt;/a&gt; is a generalization of the
common &lt;code&gt;&amp;lt;script type=&amp;quot;text/x-template&amp;quot;&amp;gt;&lt;/code&gt; trick. By rolling it into the browser, additional benefits can be realized,
allowing the template tree to be treated as an inert version of a real DOM tree, and for the element parsing and
serialization rules to specifically call out templating use cases.&lt;/p&gt;

&lt;h3 id=&quot;lt-dialog-gt&quot;&gt;&lt;code&gt;&amp;lt;dialog&amp;gt;&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&quot;http://developers.whatwg.org/commands.html#the-dialog-element&quot;&gt;&lt;code&gt;&amp;lt;dialog&amp;gt;&lt;/code&gt; element&lt;/a&gt; obviates all of the annoying
dialog or &amp;ldquo;lightbox&amp;rdquo; libraries we keep having to ship, each with their own strange semantics. Instead, it&amp;rsquo;s a simple
tag, with some imperative APIs, some declarative features, and a nice &lt;code&gt;::backdrop&lt;/code&gt; pseudo-element. Sweet!&lt;/p&gt;

&lt;h3 id=&quot;css-improvements&quot;&gt;CSS Improvements&lt;/h3&gt;

&lt;p&gt;CSS is slowly but surely starting to roll in innovations from SASS and elsewhere.
&lt;a href=&quot;http://dev.w3.org/csswg/css-hierarchies/&quot;&gt;CSS hierarchies&lt;/a&gt;, still under development, brings SASS&amp;rsquo;s nested selectors to
the browser. &lt;a href=&quot;http://dev.w3.org/csswg/css-variables/&quot;&gt;CSS variables&lt;/a&gt; uses a clever trick to get something with the same
benefits as the variables in SASS and others, but fitting in well with CSS&amp;rsquo;s existing semantics. And
&lt;a href=&quot;http://dev.w3.org/csswg/css-cascade/&quot;&gt;CSS cascade&lt;/a&gt; introduces the &lt;code&gt;unset&lt;/code&gt; keyword which reduces all those complicated
CSS reset stylesheets rules to virtually nothing.&lt;/p&gt;

&lt;h3 id=&quot;pointer-events&quot;&gt;Pointer Events&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://dvcs.w3.org/hg/pointerevents/raw-file/tip/pointerEvents.html&quot;&gt;Pointer events&lt;/a&gt; finally unify mouse and touch
events into a single abstraction. In one stroke, this obviates many libraries built to work around this strange
dichotomy introduced by mobile Safari, and around other strangeness relating to trying to use mouse events on a touch
device. They will be a welcome addition to the web platform.&lt;/p&gt;

&lt;h3 id=&quot;promises&quot;&gt;Promises&lt;/h3&gt;

&lt;p&gt;When a pattern is adopted by jQuery, Dojo, Angular, Ember, WinJS, and YUI, as well as many other popular dedicated
libraries, it&amp;rsquo;s time to put it into the platform. &lt;a href=&quot;https://github.com/domenic/promises-unwrapping&quot;&gt;Promises&lt;/a&gt; are on
track for ES6, and are being added to browsers now.&lt;/p&gt;

&lt;h2 id=&quot;what-39-s-next&quot;&gt;What&amp;rsquo;s Next?&lt;/h2&gt;

&lt;p&gt;The extensible web is an ongoing project, and several efforts are being headed up to expose even more capabilities to
developers, or roll even more common patterns into the platform. Here&amp;rsquo;s a brief taste of those I&amp;rsquo;m watching closely.&lt;/p&gt;

&lt;h3 id=&quot;streams&quot;&gt;Streams&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;FileReader&lt;/code&gt;, &lt;code&gt;XMLHttpRequest&lt;/code&gt;, &lt;code&gt;getUserMedia&lt;/code&gt;, &lt;code&gt;postMessage&lt;/code&gt;, object URLs, &lt;code&gt;MediaStream&lt;/code&gt;s… As
&lt;a href=&quot;http://imgur.com/a/9vFGa#11&quot;&gt;poignantly emphasized&lt;/a&gt; in a brilliant presentation by Max Ogden, we&amp;rsquo;re clearly missing a
unifying abstraction here, and that abstraction is streams.&lt;/p&gt;

&lt;p&gt;Node.js has led the way with their battle-tested implementations, but they&amp;rsquo;ve also learned some lessons we should be
sure to heed in order to design a good browser stream API. In the end, the goal is to be able to take various sources of
binary data (HTTP requests, camera data, payloads stored in IndexedDB, the output of a web audio graph, …) and pipe them
into various sinks (&lt;code&gt;&amp;lt;img&amp;gt;&lt;/code&gt;, &lt;code&gt;&amp;lt;video&amp;gt;&lt;/code&gt;, and &lt;code&gt;&amp;lt;audio&amp;gt;&lt;/code&gt; tags; other windows, frames, or workers; filesystem or remote HTTP
endpoints; or completely custom consumption code). It&amp;rsquo;s going to be really cool, but we have some work to do before we
get something as well-designed as promises were.&lt;/p&gt;

&lt;h3 id=&quot;fetch&quot;&gt;Fetch&lt;/h3&gt;

&lt;p&gt;The basic act of doing an HTTP request has so much complexity on the web platform: cross-domain protection; redirect
following; deserialization from bytes; cookie jars; caches… We want to provide the basic building block, and then the
ability to layer and compose each of these features on top of it.&lt;/p&gt;

&lt;h3 id=&quot;zip-zlib&quot;&gt;ZIP/ZLib&lt;/h3&gt;

&lt;p&gt;There&amp;rsquo;s active investigation going on into how to expose compression primitives to the web. This is clearly something
where native bindings will be more performant, and although there are
&lt;a href=&quot;https://github.com/imaya/zlib.js&quot;&gt;impressive polyfills&lt;/a&gt;, native APIs, preferably with asynchronous off-main-thread
compression, will enable new scenarios. This work is in its early stages, so if you want to get involved, reach out.&lt;/p&gt;

&lt;h3 id=&quot;class-elements-extends-array&quot;&gt;&lt;code&gt;class Elements extends Array&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;My personal favorite new feature is the upcoming
&lt;a href=&quot;http://dom.spec.whatwg.org/#collections:-elements&quot;&gt;&lt;code&gt;Elements&lt;/code&gt; collection&lt;/a&gt;. It&amp;rsquo;s a proper array subclass, using the
aforementioned ES6 subclassable builtin support, to give you something where you can &lt;em&gt;finally&lt;/em&gt; use &lt;code&gt;forEach&lt;/code&gt;, &lt;code&gt;reduce&lt;/code&gt;,
&lt;code&gt;filter&lt;/code&gt;, and all your favorite methods.&lt;/p&gt;

&lt;p&gt;As part of this effort we added two methods, &lt;code&gt;query&lt;/code&gt; and &lt;code&gt;queryAll&lt;/code&gt;, to both &lt;code&gt;Element.prototype&lt;/code&gt; and to
&lt;code&gt;Elements.prototype&lt;/code&gt;. They act as better versions of &lt;code&gt;querySelector&lt;/code&gt; and &lt;code&gt;querySelectorAll&lt;/code&gt;, in that they treat relative
selectors like &lt;code&gt;&amp;quot;&amp;gt; div&amp;quot;&lt;/code&gt; the way you would expect instead of throwing an error. The versions on &lt;code&gt;Elements.prototype&lt;/code&gt; act
as composite operations over all elements in the collection, just like in jQuery.&lt;/p&gt;

&lt;p&gt;This is the beginning of a new, friendlier DOM, and I&amp;rsquo;m pretty excited about it.&lt;/p&gt;

&lt;h3 id=&quot;what-else&quot;&gt;What Else?&lt;/h3&gt;

&lt;p&gt;What do we need? What is preventing you from building the web apps of your dreams? You tell us! The extensible web is
waiting for your participation!&lt;/p&gt;

&lt;h2 id=&quot;getting-involved&quot;&gt;Getting Involved&lt;/h2&gt;

&lt;p&gt;The best thing you can do to get involved in the extensible web is &lt;em&gt;prolyfill&lt;/em&gt;. There&amp;rsquo;s only so much standardization
bandwidth to go around, so if you can create a de-facto standard like jQuery, or an open specification with wide
implementer suppport like Promises/A+, the world is waiting.&lt;/p&gt;

&lt;p&gt;For example, if you wanted to figure out what a zlib API for the browser should look like, the best thing you can do is:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Learn what the constraints and use cases are. (And not just your use cases, but everyone&amp;rsquo;s!)&lt;/li&gt;
&lt;li&gt;Design an API and library to prolyfill this gap.&lt;/li&gt;
&lt;li&gt;Evangelize its use among developers, so that everyone recognizes it as the clear solution that browsers should just
ship and be done with it.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;More generally, if you want to be involved in helping the web succeed by guiding us toward better standards, then let&amp;rsquo;s
talk. It&amp;rsquo;s an area I&amp;rsquo;ve been diving into over the last year, stemming from my Promises/A+ work but expanding into many
other things. Finding the right approach and content is delicate, as these people are jaded by newbies coming out of the
woodwork to demand feature X. But if you approach in good faith and avoid a prideful demeanor, they&amp;rsquo;re often happy to
listen. I&amp;rsquo;ve had a few success stories in this area already, and by this time next year I want to have a lot more.&lt;/p&gt;

&lt;p&gt;In fact, I gave a talk on this subject at LXJS, titled
&lt;a href=&quot;https://www.youtube.com/watch?v=hneN6aW-d9w&amp;amp;hd=1&quot;&gt;&amp;ldquo;How to Win Friends and Influence Standards Bodies&amp;rdquo;&lt;/a&gt;. I&amp;rsquo;ll probably
be adapting it into blog post form soon.&lt;/p&gt;

&lt;p&gt;Another thing I wanted to note, before closing out, is that this extensible web philosophy has teeth. The W3C Technical
Architecture Group had four seats go up for reelection recently. Four &amp;ldquo;reformers&amp;rdquo; were elected at once: Yehuda Katz,
Alex Russell, Marcos Caceres, and Anne van Kesteren. The extensible web philosophy underlies their governance, as the
ultimate technical body which provides guidance and approval for all W3C specs. We&amp;rsquo;ve already seen fruit here with their
&lt;a href=&quot;https://github.com/w3ctag/spec-reviews/blob/master/2013/07/WebAudio.md&quot;&gt;review of the web audio spec&lt;/a&gt;,
&lt;a href=&quot;https://github.com/w3ctag/spec-reviews&quot;&gt;among others&lt;/a&gt;. They&amp;rsquo;ve been helping specs build on a solid grounding in
JavaScript fundamentals, and generally be less magic and more JavaScript. All their work is being done
&lt;a href=&quot;https://github.com/w3ctag&quot;&gt;on GitHub&lt;/a&gt;, as are more and more specifications. This is happening!&lt;/p&gt;

&lt;p&gt;To close, I&amp;rsquo;d like to give a short message of hope. It&amp;rsquo;s easy to think about all these cool things that are coming, and
then get depressed about having to support IE8 or Android 2.3 at your job. But that&amp;rsquo;s the price we pay for an open,
interoperable web. We can&amp;rsquo;t just march to the tune of a single vendor, upgrading in lockstep. Instead we work through
this collaborative, cooperative process, to build our shared language. In the end, &lt;em&gt;the future is longer than the past&lt;/em&gt;,
and I look forward not only to living in that future, but to helping shape it, together with you all.&lt;/p&gt;
</description>
        <pubDate>Mon, 07 Oct 2013 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/the-extensible-web/</link>
        <guid isPermaLink="true">https://blog.domenic.me/the-extensible-web/</guid>
        
        
        <category>Web</category>
        
      </item>
    
      <item>
        <title>ES6 Iterators, Generators, and Iterables</title>
        <description>&lt;p&gt;I wrote up a quick guide to the terminology around ES6&amp;rsquo;s iteration-related concepts, plus some notes and other
resources.&lt;/p&gt;

&lt;h2 id=&quot;definitions&quot;&gt;Definitions&lt;/h2&gt;

&lt;p&gt;An &lt;strong&gt;iterator&lt;/strong&gt; is an object with a &lt;code&gt;next&lt;/code&gt; method that returns &lt;code&gt;{ done, value }&lt;/code&gt; tuples.&lt;/p&gt;

&lt;p&gt;An &lt;strong&gt;iterable&lt;/strong&gt; is an object which has an internal method, written in the current ES6 draft specs as
&lt;code&gt;obj[@@iterator]()&lt;/code&gt;, that returns an iterator.&lt;/p&gt;

&lt;p&gt;A &lt;strong&gt;generator&lt;/strong&gt; is a specific type of iterator whose &lt;code&gt;next&lt;/code&gt; results are determined by the behavior of its corresponding
generator function. Generators also have a &lt;code&gt;throw&lt;/code&gt; method, and their &lt;code&gt;next&lt;/code&gt; method takes a parameter.&lt;/p&gt;

&lt;p&gt;A &lt;strong&gt;generator function&lt;/strong&gt; is a special type of function that acts as a constructor for generators. Generator function
bodies can use the contextual keyword &lt;code&gt;yield&lt;/code&gt;, and you can send values or exceptions into the body, at the points where
&lt;code&gt;yield&lt;/code&gt; appears, via the constructed generator&amp;rsquo;s &lt;code&gt;next&lt;/code&gt; and &lt;code&gt;throw&lt;/code&gt; methods. Generator functions are written with
&lt;code&gt;function*&lt;/code&gt; syntax.&lt;/p&gt;

&lt;p&gt;A &lt;strong&gt;generator comprehension&lt;/strong&gt; is a shorthand expression for creating generators, e.g.
&lt;code&gt;(for (x of a) for (y of b) x * y)&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;notes&quot;&gt;Notes&lt;/h2&gt;

&lt;h3 id=&quot;for-of&quot;&gt;&lt;code&gt;for&lt;/code&gt;-&lt;code&gt;of&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;The new &lt;code&gt;for&lt;/code&gt;-&lt;code&gt;of&lt;/code&gt; loop works on iterables, i.e. you do &lt;code&gt;for (let x of iterable) { /* ... */ }&lt;/code&gt;. So for example, it
works on arrays by looking up their &lt;code&gt;Array.prototype[@@iterator]()&lt;/code&gt; internal method, which is specified to return an
iterator that does what you&amp;rsquo;d expect. Similarly &lt;code&gt;Map.prototype&lt;/code&gt;, &lt;code&gt;Set.prototype&lt;/code&gt;, and others all have &lt;code&gt;@@iterator&lt;/code&gt;
methods that help them work with &lt;code&gt;for&lt;/code&gt;-&lt;code&gt;of&lt;/code&gt; and other constructs in the language that consume iterators.&lt;/p&gt;

&lt;p&gt;Note that &lt;code&gt;for&lt;/code&gt;-&lt;code&gt;in&lt;/code&gt; has nothing to do with iterables, or indeed any of the concepts discussed here. It still works as
it did before, looping through enumerable object properties, and it will be pretty useless when given an iterable of any
sort.&lt;/p&gt;

&lt;h3 id=&quot;iterable-iterators&quot;&gt;Iterable Iterators&lt;/h3&gt;

&lt;p&gt;An &lt;em&gt;iterator&lt;/em&gt; can also be &lt;em&gt;iterable&lt;/em&gt; if it has an &lt;code&gt;@@iterator()&lt;/code&gt; internal method. Most iterators in the ES6 draft spec
are also iterable, with the internal method just returning &lt;code&gt;this&lt;/code&gt;. In particular, all generators created via generator
functions or generator comprehensions have this behavior. So you can do:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;lazySequence&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;lazySequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;making-iterable-objects&quot;&gt;Making Iterable Objects&lt;/h3&gt;

&lt;p&gt;To make a custom iterable object, you use the &lt;code&gt;Symbol.iterator&lt;/code&gt; symbol, which is the inside-JavaScript way of referring
to the specification&amp;rsquo;s &lt;code&gt;@@iterator&lt;/code&gt;. It should return an iterator, thus making your object iterable. The easiest way to
write the iterator-returning method is to use generator syntax. Putting this all together, it looks like&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iterable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Symbol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;iterator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iterable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;generator-comprehension-desugaring&quot;&gt;Generator Comprehension Desugaring&lt;/h3&gt;

&lt;p&gt;You can think of generator comprehensions as &amp;ldquo;sugar&amp;rdquo; for writing out and immediately invoking a generator function, with
&lt;code&gt;yield&lt;/code&gt;s inserted implicitly at certain points. For example, the comprehension &lt;code&gt;(for (x of a) for (y of b) x * y)&lt;/code&gt;
desugars to&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;a-weirdness&quot;&gt;A Weirdness&lt;/h3&gt;

&lt;p&gt;It&amp;rsquo;s not entirely clear why generator comprehensions create generators instead of simple iterable-iterators. In
particular, as you can see from the above desugaring, calling &lt;code&gt;throw&lt;/code&gt; or giving a parameter to &lt;code&gt;next&lt;/code&gt; is pretty useless:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;                   &lt;span class=&quot;c1&quot;&gt;// returns { done: false, value: 1 }&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                  &lt;span class=&quot;c1&quot;&gt;// returns { done: false, value: 2 }&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;boo!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// immediately throws the error&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It seems the arguments in favor of generators instead of iterable-iterators are largely that it makes implementers&amp;rsquo; jobs
easier, at least according to
&lt;a href=&quot;http://esdiscuss.org/topic/why-do-generator-expressions-return-generators&quot;&gt;this es-discuss thread&lt;/a&gt; I started.&lt;/p&gt;

&lt;h2 id=&quot;implementation-status&quot;&gt;Implementation Status&lt;/h2&gt;

&lt;p&gt;Due to the tireless work of &lt;a href=&quot;http://wingolog.org/&quot;&gt;Andy Wingo&lt;/a&gt;, V8 (Chrome) has support for generator functions, behind
the &lt;code&gt;--harmony&lt;/code&gt; flag (or &amp;ldquo;Experimental JavaScript Features&amp;rdquo; in chrome://flags). It also has some form of &lt;code&gt;for&lt;/code&gt;-&lt;code&gt;of&lt;/code&gt;,
which only works with generators and with the custom iterables returned by &lt;code&gt;Array.prototype.values&lt;/code&gt; and
&lt;code&gt;Array.prototype.keys&lt;/code&gt;, but does not work with anything else (e.g. arrays themselves). I assume this is because the
iteration protocol has not been implemented yet. V8 does not have generator comprehensions.&lt;/p&gt;

&lt;p&gt;SpiderMonkey (Firefox) has an old version of everything here, with outdated syntax and semantics. Over the last week or
so, Andy has submitted patches to update their generator implementation. He&amp;rsquo;s now working on &lt;code&gt;for&lt;/code&gt;-&lt;code&gt;of&lt;/code&gt; and the
iteration protocol in &lt;a href=&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=907077&quot;&gt;bug #907077&lt;/a&gt;; no word on generator
comprehensions. Note that SpiderMonkey, unlike V8, does not hide these features behind a default-off flag.&lt;/p&gt;

&lt;p&gt;Chakra (Internet Explorer) is as always a complete mystery, with no transparency into their development cycle or even
priority list.&lt;/p&gt;

&lt;p&gt;And I still haven&amp;rsquo;t forgiven JavaScriptCore (Safari) for its long period of forgetting to implement
&lt;code&gt;Function.prototype.bind&lt;/code&gt;, so I haven&amp;rsquo;t even tried looking into their status.&lt;/p&gt;
</description>
        <pubDate>Fri, 06 Sep 2013 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/es6-iterators-generators-and-iterables/</link>
        <guid isPermaLink="true">https://blog.domenic.me/es6-iterators-generators-and-iterables/</guid>
        
        
        <category>JavaScript</category>
        
      </item>
    
      <item>
        <title>Explaining Away the Web&#39;s Magic</title>
        <description>&lt;p&gt;Today we revealed &lt;a href=&quot;http://extensiblewebmanifesto.org/&quot;&gt;The Extensible Web Manifesto&lt;/a&gt;, calling for a new approach to
web standards that prioritizes new local-level capabilities in order to explain and extend higher-end platform features.
I want to take a minute to talk about what this means in practice, and why it&amp;rsquo;s different from how we operate today.&lt;/p&gt;

&lt;h2 id=&quot;show-me-the-magic&quot;&gt;Show Me the Magic!&lt;/h2&gt;

&lt;p&gt;The core of the extensible web manifesto says two things:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;We should &lt;em&gt;expose new low-level capabilities&lt;/em&gt; to JavaScript&lt;/li&gt;
&lt;li&gt;We should &lt;em&gt;explain existing high-level features&lt;/em&gt; in terms of JavaScript&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The first of these is fairly obvious, but important. It&amp;rsquo;s this goal that has brought us things that were previously
restricted to native apps or Flash, e.g. webcam and geolocation access, or WebGL. Even something as simple as the page
visibility API is a nice, low-level capability that helps us build our apps in ways we couldn&amp;rsquo;t do before.&lt;/p&gt;

&lt;p&gt;What all of these low-level APIs have in common is that they&amp;rsquo;re exposing &amp;ldquo;C++ magic&amp;rdquo; to us, the web developers. They&amp;rsquo;re
bridging the gap between native hardware and OS capabilities, into the realm of web applications. This is good. This is
where the magic belongs: where our technology fails us.&lt;/p&gt;

&lt;p&gt;The second point is where things get subtle. Because it turns out there&amp;rsquo;s a lot more C++ magic going on in your browser
than just access to hardware, or to OpenGL bindings. Arguably the biggest amount of magic in the web platform is the
magic we take for granted: the magic that translates declarative HTML and CSS into what we see on the screen and
manipulate with JavaScript.&lt;/p&gt;

&lt;p&gt;This is the more revolutionary part of the extensible web manifesto. It&amp;rsquo;s drawing a line in the sand and saying: &lt;strong&gt;the
C++ magic stops here&lt;/strong&gt;. We need to stop building high-level features of the platform out of magic when it&amp;rsquo;s not
necessary to do so, and we need to explain the existing features in terms of JavaScript technology—not C++ magic—at
least until we bottom out at the low-level hardware capabilities discussed above. By taking this stand, we enable users
to extend the web platform without rebuilding it from scratch.&lt;/p&gt;

&lt;h2 id=&quot;extendthwebforward-in-practice&quot;&gt;#extendthwebforward In Practice&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Custom tags&lt;/strong&gt; are a great example of this principle in action. If you stick to a pre-defined list defined by the W3C,
then you can use your declarative HTML all over the place. Each tag gets turned into its own JavaScript counterpart via
the parser, whether it be the humble transformation of &lt;code&gt;&amp;lt;p&amp;gt;&lt;/code&gt; into &lt;code&gt;HTMLParagraphElement&lt;/code&gt; or the complex wirings between
&lt;code&gt;&amp;lt;img&amp;gt;&lt;/code&gt; and &lt;code&gt;HTMLImageElement&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Everything the W3C doesn&amp;rsquo;t know about, however, gets turned into the featureless blob that is &lt;code&gt;HTMLUnknownElement&lt;/code&gt;. Hrm.&lt;/p&gt;

&lt;p&gt;There&amp;rsquo;s clearly a lot of magic going on here, most of it encapsulated in that &amp;ldquo;parser&amp;rdquo; thing. What if the parser was
extensible, and could be explained in terms of a JavaScript API? What if we pushed the magic further back? A good first
step might be allowing
&lt;a href=&quot;http://www.polymer-project.org/platform/custom-elements.html&quot;&gt;the registration of custom elements&lt;/a&gt;. That way, we could
explain the inner workings of this magic parser in terms of how it looks up an element name in a registry, and then
derives instances from that registry. This has a wonderful emergent property as well: now that HTML elements are
explained by a C++ parser turning HTML into JavaScript, our JavaScript objects can use the usual mechanisms of the
language, like prototypal inheritance and constructors, to build on existing HTML elements.&lt;/p&gt;

&lt;p&gt;The &lt;strong&gt;shadow DOM&lt;/strong&gt; is another of my favorite examples. While &lt;code&gt;&amp;lt;p&amp;gt;&lt;/code&gt; might be a relatively non-magical element, clearly
there&amp;rsquo;s a lot of crazy stuff going on with &lt;code&gt;&amp;lt;select&amp;gt;&lt;/code&gt;! And don&amp;rsquo;t get me started on &lt;code&gt;&amp;lt;audio&amp;gt;&lt;/code&gt; and &lt;code&gt;&amp;lt;video&amp;gt;&lt;/code&gt;. It&amp;rsquo;s as if
there&amp;rsquo;s a whole, um, shadow DOM, hidden underneath the one we see, accessible only by C++. The goal of the shadow DOM
spec, going back to its &lt;a href=&quot;http://glazkov.com/2011/01/14/what-the-heck-is-shadow-dom/&quot;&gt;earliest conception&lt;/a&gt;, has been to
bring that magic out of C++ and explain it in terms of
&lt;a href=&quot;http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom/&quot;&gt;JavaScript primitives&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But it&amp;rsquo;s not just these large examples, attempting to explain HTML. What about something as simple as … &lt;strong&gt;parsing
URLs&lt;/strong&gt;? Clearly, the platform has this capability:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;href&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http://infrequently.org/2012/04/bedrock/#comments&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pathname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But somehow, this capability got tied up inside the high-level abstraction of the &lt;code&gt;&amp;lt;a&amp;gt;&lt;/code&gt; element, and isn&amp;rsquo;t accessible
to us directly as JavaScript programmers. We&amp;rsquo;re left reimplementing it, often
&lt;a href=&quot;https://github.com/joyent/node/issues/5452&quot;&gt;incorrectly&lt;/a&gt;, on our own. It&amp;rsquo;s this kind of travesty that work like
&lt;a href=&quot;http://url.spec.whatwg.org/#constructors&quot;&gt;the URL spec&lt;/a&gt; in particular, and the extensible web movement in general, is
trying to prevent.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s keep going. What does this do?&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;els&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;querySelectorAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;:enabled&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Well, hmm, something about &lt;a href=&quot;http://www.w3.org/TR/css3-selectors/#enableddisabled&quot;&gt;&amp;ldquo;an enabled state&amp;rdquo;&lt;/a&gt;. I wonder what
that means. Probably something to do with
&lt;a href=&quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/association-of-controls-and-forms.html#enabling-and-disabling-form-controls:-the-disabled-attribute&quot;&gt;the &lt;code&gt;disabled&lt;/code&gt; attribute&lt;/a&gt;. How did the browser know that? More magic! We passed in a string that&amp;rsquo;s in a magic
list called &amp;ldquo;CSS3 selectors spec,&amp;rdquo; and it has some magic handler that turns that into &amp;ldquo;elements where
&lt;code&gt;el.disabled === false&lt;/code&gt;.&amp;rdquo; This is a pretty high-level abstraction; could we explain it with technology instead of magic?
What about some kind of &lt;strong&gt;CSS selector registration&lt;/strong&gt;?&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-js&quot; data-lang=&quot;js&quot;&gt;&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;registerSelector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;:enabled&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;el&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;el&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;disabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It&amp;rsquo;s of course more complicated than that. To make this performant and sensible, we&amp;rsquo;re going to need some way to ensure,
or at least assume, that the function passed is pure (i.e. side-effect free and gives the same answers to the same
inputs). But we &lt;a href=&quot;http://wiki.ecmascript.org/doku.php?id=strawman:data_parallelism&quot;&gt;need something like that anyway&lt;/a&gt;.
It&amp;rsquo;ll happen.&lt;/p&gt;

&lt;p&gt;There&amp;rsquo;s so many more examples. Once you start seeing the web browser in this way, trying to pick apart and explain its
C++ magic in terms of JavaScript technology, you&amp;rsquo;ll have a hard time un-seeing how much work needs to be done. Here&amp;rsquo;s
just a brief scratchpad idea list:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://gist.github.com/wycats/cf73dd4c974352fcb767&quot;&gt;Low-level HTTP fetching and data streams&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;More general and composable binary data streams, &lt;a href=&quot;http://imgur.com/a/9vFGa#11&quot;&gt;à la Node.js&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.polymer-project.org/platform/web-animations.html&quot;&gt;Unified animations primitives&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/slightlyoff/NavigationController/blob/master/explainer.md&quot;&gt;A way of responding to requests when your app is offline&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Exposed GZIP capabilities&lt;/li&gt;
&lt;li&gt;Custom scrollbars&lt;/li&gt;
&lt;li&gt;Custom tooltips&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://davidwalsh.name/html5-context-menu&quot;&gt;Custom context menus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://lists.w3.org/Archives/Public/www-dom/2013AprJun/0188.html&quot;&gt;Deferred, but synchronous, exception handling&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://updates.html5rocks.com/2012/11/Respond-to-change-with-Object-observe&quot;&gt;Observing and responding to changes to JS objects&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;what-39-s-next&quot;&gt;What&amp;rsquo;s Next&lt;/h2&gt;

&lt;p&gt;The extensible web manifesto was a statement of intent, and of prioritization.&lt;/p&gt;

&lt;p&gt;Some of the reaction to it has been along the lines of &amp;ldquo;Well … duh!?&amp;rdquo; To which I reply: exactly! This &lt;em&gt;should&lt;/em&gt; be obvious. But if you look at how the standards process has worked
&lt;a href=&quot;https://medium.com/the-future-of-the-web/2fcd1c1bb32&quot;&gt;historically&lt;/a&gt;, that&amp;rsquo;s not what happened. Implementers handed down
new high-level solutions from their ivory towers, &lt;a href=&quot;http://news.cnet.com/8301-17939_109-10281477-2.html&quot;&gt;without knowing&lt;/a&gt;
if they actually solved the problems we as developers actually had. Or they knew we needed some primitive, but gave us
&lt;a href=&quot;http://updates.html5rocks.com/2013/03/What-s-the-CSS-scope-pseudo-class-for&quot;&gt;a slightly messed-up version of it&lt;/a&gt;, due
to lack of attention to common use cases. It&amp;rsquo;s been somewhat tragic, actually.&lt;/p&gt;

&lt;p&gt;The publication of the extensible web manifesto is taking a stand for a process that should help avoid these missteps,
by doing what we should have been doing all along. In short, &lt;em&gt;prioritize efforts to expose low-level tools&lt;/em&gt;; then,
watch what the developer community converges on and fold that back into the web platform &lt;em&gt;now that we know it solves
common high-level use cases&lt;/em&gt;. And this ideology has teeth: the W3C&amp;rsquo;s newly-reformed
&lt;a href=&quot;http://www.w3.org/2001/tag/2013/03/18-agenda&quot;&gt;Technical Architecture Group&lt;/a&gt; has taken on the case of overseeing this
effort, ensuring that new APIs are introduced to explain away the C++ magic in terms of idiomatic JavaScript.&lt;/p&gt;

&lt;p&gt;This is something I can get behind.&lt;/p&gt;
</description>
        <pubDate>Mon, 10 Jun 2013 00:00:00 +0000</pubDate>
        <link>https://blog.domenic.me/explaining-away-the-webs-magic/</link>
        <guid isPermaLink="true">https://blog.domenic.me/explaining-away-the-webs-magic/</guid>
        
        
        <category>Web</category>
        
      </item>
    
  </channel>
</rss>
